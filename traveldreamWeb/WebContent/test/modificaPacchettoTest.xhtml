<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"> 

<h:head>
	<title>Modifica Pacchetto Test</title>
</h:head> 
<body>
	<h1>Elenco Pacchetti</h1>
	<h:link value="indietro" outcome="pacchettoTest" />
	<h:form>
		<h:outputText value="email:" />
		<h:inputText binding="#{email}" />

		<h:commandButton value="Cerca" action="#{pacchetto.cercaPacchetto(email.value)}" />
	</h:form>
	<h:messages />
	<h:form>
		<ui:repeat value="#{pacchetto.elenco}" var="p" rendered="#{pacchetto.elenco.size() > 0}">
			<h4>Pacchetto:</h4>
			Nome:&nbsp;
			<h:outputText value="#{p.nome}" rendered="#{not p.editable}" /><br />
			<h:inputText value="#{p.nome}" rendered="#{p.editable}" /><br />
			
			Partenza:&nbsp;
			<h:outputText value="#{p.citta.nome}" rendered="#{not p.editable}" /><br />
			<h:inputText value="#{p.citta.nome}" rendered="#{p.editable}" /><br />
			
			Partecipanti:&nbsp;
			<h:outputText value="#{p.numPartecipanti}" rendered="#{not p.editable}" /><br />
			<h:inputText value="#{p.numPartecipanti}" rendered="#{p.editable}" /><br />
			
			Prezzo:&nbsp;
			<h:outputText value="#{p.prezzo}" /><br />
			
			<h:commandButton action="#{pacchetto.abilitaModifica(p)}" value="modifica" rendered="#{not p.editable}" />
			<h:commandButton action="#{pacchetto.eliminaPacchetto(p)}" value="elimina" rendered="#{not p.editable}" />
			<h:commandButton action="#{pacchetto.salvaPacchetto(p)}" value="salva" rendered="#{p.editable}" />
			<h:commandButton action="#{pacchetto.disabilitaModifica(p)}" value="annulla" rendered="#{p.editable}" />			
			<br />
			
			<h4>Destinazioni:</h4>
			<ui:repeat var="d" value="#{p.destinazioni}">
				<h:panelGroup rendered="#{pacchetto.esisteCollegamento(p, d.dataArrivo)}">
					Il
					<h:outputText value="#{pacchetto.getCollegamento(p, d.dataArrivo).dataPartenza}">
						<f:convertDateTime pattern="dd/MM/yyyy" timeZone="Europe/Rome" />
					</h:outputText>
					alle
					<h:outputText value="#{pacchetto.getCollegamento(p, d.dataArrivo).oraPartenza}">
						<f:convertDateTime pattern="HH:mm" timeZone="Europe/Rome" />
					</h:outputText>
					da #{pacchetto.getCollegamento(p, d.dataArrivo).cittaPartenza.nome} (#{pacchetto.getCollegamento(p, d.dataArrivo).origine}) a #{pacchetto.getCollegamento(p, d.dataArrivo).cittaArrivo.nome} (#{pacchetto.getCollegamento(p, d.dataArrivo).destinazione})
				</h:panelGroup>
				<h:panelGroup rendered="#{not pacchetto.esisteCollegamento(p, d.dataArrivo)}">
					<h:link value="aggiunta collegamento" outcome="aggiuntaCollegamentoTest?faces-redirect=true">
						<f:param name="idPacchetto" value="#{p.id}" />
						<f:param name="dataPartenza" value="#{pacchetto.getData(d.dataArrivo)}" />
						<f:param name="cittaPartenza" value="#{pacchetto.getCittaPartenza(p,d)}" />
						<f:param name="cittaArrivo" value="#{d.citta.nome}" />
					</h:link>
				</h:panelGroup>					
				<br /><br />
				Dal <h:outputText value="#{d.dataArrivo}">
					<f:convertDateTime pattern="dd/MM/yyyy" timeZone="Europe/Rome" />
				</h:outputText>
				Al <h:outputText value="#{d.dataPartenza}">
					<f:convertDateTime pattern="dd/MM/yyyy" timeZone="Europe/Rome" />
				</h:outputText><br />	
				<h:outputText value="#{d.hotel.nome} a #{d.citta.nome} (#{d.citta.nazione})" />
				<h:commandButton value="elimina destinazione" action="#{pacchetto.eliminaDestinazione(p, d)}" />
				<br /><br />
				<h:panelGroup rendered="#{pacchetto.isUltimaDestinazione(p,d) and pacchetto.esisteCollegamento(p, d.dataPartenza)}">
					Il
					<h:outputText value="#{pacchetto.getCollegamento(p, d.dataPartenza).dataPartenza}">
						<f:convertDateTime pattern="dd/MM/yyyy" timeZone="Europe/Rome" />
					</h:outputText>
					alle
					<h:outputText value="#{pacchetto.getCollegamento(p, d.dataPartenza).oraPartenza}">
						<f:convertDateTime pattern="HH:mm" timeZone="Europe/Rome" />
					</h:outputText>
					da #{pacchetto.getCollegamento(p, d.dataPartenza).cittaPartenza.nome} (#{pacchetto.getCollegamento(p, d.dataPartenza).origine}) a #{pacchetto.getCollegamento(p, d.dataPartenza).cittaArrivo.nome} (#{pacchetto.getCollegamento(p, d.dataPartenza).destinazione})
					<br /><br />
				</h:panelGroup>
				<h:panelGroup rendered="#{pacchetto.isUltimaDestinazione(p,d) and (not pacchetto.esisteCollegamento(p, d.dataPartenza))}">
					<h:link value="aggiunta collegamento" outcome="aggiuntaCollegamentoTest?faces-redirect=true">
						<f:param name="idPacchetto" value="#{p.id}" />
						<f:param name="dataPartenza" value="#{pacchetto.getData(d.dataPartenza)}" />
						<f:param name="cittaPartenza" value="#{d.citta.nome}" />
						<f:param name="cittaArrivo" value="#{p.citta.nome}" />						
					</h:link>
					<br /><br />
				</h:panelGroup>
			</ui:repeat>
			<h:link value="aggiunta destinazione" outcome="aggiuntaDestinazioneTest?faces-redirect=true">
				<f:param name="id-pacchetto" value="#{p.id}" />
			</h:link>
		</ui:repeat>
	</h:form>
</body> 
</html>
